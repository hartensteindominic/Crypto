<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocket Mint | Final</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/index.umd.min.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .container { background: #111; border: 1px solid #333; padding: 40px; border-radius: 20px; text-align: center; width: 320px; }
        button { width: 100%; padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .btn-blue { background: #007bff; color: white; }
        .btn-green { background: #28a745; color: white; }
        input { width: 100%; padding: 12px; margin: 15px 0; background: #000; border: 1px solid #444; color: #0f0; text-align: center; box-sizing: border-box; }
        #status { margin-top: 20px; font-size: 12px; color: #888; line-height: 1.4; }
        #rocket { font-size: 60px; margin-bottom: 10px; display: none; }
        .fly { animation: launch 1.5s forwards; }
        @keyframes launch { to { transform: translateY(-400px); opacity: 0; } }
    </style>
</head>
<body>

<div class="container">
    <div id="rocket">ðŸš€</div>
    <h2 id="title">Rocket Mint</h2>
    
    <button id="connectBtn" class="btn-blue">Connect Wallet</button>

    <div id="mintArea" style="display: none;">
        <p>Enter ETH to Stake:</p>
        <input type="number" id="ethAmount" value="0.001" step="0.001" min="0.0001">
        <button id="mintBtn" class="btn-green">MINT & LAUNCH</button>
    </div>

    <div id="status">Please connect your wallet to begin.</div>
</div>

<script>
    // 1. FIXED: Correctly checksummed address (Mixed case is mandatory)
    const RECIPIENT = "0x02F949281A8c9837963C82813589B845C5194Cbb";
    let signer;

    const connectBtn = document.getElementById('connectBtn');
    const mintArea = document.getElementById('mintArea');
    const status = document.getElementById('status');
    const rocket = document.getElementById('rocket');

    // 2. STABLE CONNECTION LOGIC
    connectBtn.onclick = async () => {
        if (!window.ethereum) {
            status.innerText = "Error: Web3 browser not detected. Please open this link inside MetaMask.";
            return;
        }

        try {
            status.innerText = "Requesting connection...";
            const provider = new ethers.BrowserProvider(window.ethereum);
            
            // This triggers the actual pop-up in your wallet
            signer = await provider.getSigner();
            const address = await signer.getAddress();

            connectBtn.style.display = 'none';
            mintArea.style.display = 'block';
            status.innerHTML = `Connected:<br><b>${address.slice(0,6)}...${address.slice(-4)}</b>`;
        } catch (err) {
            console.error(err);
            status.innerText = "Connection failed. Please unlock your wallet and try again.";
        }
    };

    // 3. SECURE TRANSACTION LOGIC
    document.getElementById('mintBtn').onclick = async () => {
        const amount = document.getElementById('ethAmount').value;
        
        try {
            status.innerText = "Confirm transaction in your wallet...";
            
            const tx = await signer.sendTransaction({
                to: RECIPIENT,
                value: ethers.parseEther(amount.toString())
            });

            status.innerText = "Transaction pending... Waiting for blockchain.";

            // Wait for 1 block confirmation
            const receipt = await tx.wait();

            // Success Animation
            rocket.style.display = 'block';
            rocket.classList.add('fly');
            status.innerHTML = `MISSION SUCCESS!<br><a href="https://etherscan.io/tx/${tx.hash}" target="_blank" style="color:#0f0">View on Etherscan</a>`;
            
        } catch (err) {
            console.error(err);
            status.innerText = "Error: " + (err.reason || "Transaction rejected.");
        }
    };
</script>

</body>
</html>
